<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Auto Car Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root { --pad: 12px; --radius: 14px; }
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin:0; background:#0b0f14; color:#e8edf2;}
      header { display:flex; gap:12px; align-items:center; padding:16px; border-bottom:1px solid #1e2835; position:sticky; top:0; background:#0b0f14d9; backdrop-filter: blur(6px); z-index:10; }
      header h1 { font-size:18px; margin:0; }
      .pill { padding:6px 10px; border:1px solid #2b3a4f; border-radius:999px; font-size:12px; }
      main { display:grid; grid-template-columns: 2fr 1fr; gap:16px; padding:16px; }
      .card { background:#0f1520; border:1px solid #1e2835; border-radius: var(--radius); padding: var(--pad); }
      .card h2 { margin:0 0 8px 0; font-size:16px; color:#bcd1ff; }
      .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
      button, .toggle { background:#152033; color:#d7e4ff; border:1px solid #2b3a4f; border-radius:10px; padding:8px 12px; cursor:pointer; }
      button:active { transform: translateY(1px); }
      input[type=range] { width: 100%; }
      .video { width:100%; border-radius: 10px; border:1px solid #2b3a4f; background:#000; }
      .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; background:#0b0f14; border:1px solid #2b3a4f; padding:2px 6px; border-radius:6px; }
      .grid { display:grid; grid-template-columns: repeat(16, 1fr); gap:4px; }
      .cell { aspect-ratio: 1; background:#132034; border-radius:4px; border:1px solid #1e2835; cursor:pointer; }
      .cell.goal { outline: 2px solid #66ffb2; }
      .status-dot { width:10px; height:10px; border-radius:50%; display:inline-block; margin-right:6px; background:#888; transition: background 0.3s; }
      .status-dot.on { background:#40f28a;}
      @media (max-width: 900px){ main{ grid-template-columns:1fr; } }
    </style>
  </head>
  <body>
    <header>
      <h1>Auto Car</h1>
      <span class="pill">Tele-op & Autonomous</span>
      <span class="pill"><span id="wsdot" class="status-dot"></span>WS</span>
      <span class="pill"><span id="viddot" class="status-dot on"></span>Video</span>
    </header>
    <main>
      <section class="card">
        <h2>Live Video</h2>
        <img id="video" class="video" src="/video.mjpg" />
        <div class="row" style="margin-top:8px;">
          <button id="stop">Brake</button>
          <button id="auton">Autonomous: <span id="auton_state">OFF</span></button>
          <span>Speed:</span><input id="spd" type="range" min="0.3" max="2.0" step="0.1" value="1.0"/>
          <span class="kbd">WASD</span> move, <span class="kbd">Q/E</span> rotate, hold <span class="kbd">Shift</span> turbo
        </div>
      </section>
      <section class="card">
        <h2>Mini-Map (click to set goal)</h2>
        <div id="grid" class="grid"></div>
        <div style="height:8px"></div>
        <div class="row">
          <button id="clear">Clear Goal</button>
        </div>
      </section>
      <section class="card">
        <h2>Tuning</h2>
        <div class="row">
          <label>Kp <input id="kp" type="number" step="0.01" value="0.35"/></label>
          <label>Ki <input id="ki" type="number" step="0.01" value="0.00"/></label>
          <label>Kd <input id="kd" type="number" step="0.01" value="0.015"/></label>
          <button id="apply">Apply</button>
        </div>
      </section>
      <section class="card">
        <h2>OTA & Utilities</h2>
        <div class="row">
          <button id="ota">Pull Latest</button>
          <button id="reboot">Reboot (demo)</button>
        </div>
      </section>
    </main>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js" crossorigin="anonymous"></script>
    <script src="/static/js/teleop.js"></script>
  </body>
</html>
